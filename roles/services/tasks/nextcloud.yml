---
- name: Create a Nextcloud network
  containers.podman.podman_network:
    name: nextcloud_network

- name: Create Nextcloud volumes
  containers.podman.podman_volume:
    state: present
    name: "{{ item }}"
  loop: 
    - mariadb_data
    - nextcloud_config

- name: Run Mariadb container
  containers.podman.podman_container:
    name: mariadb
    image: docker.io/library/mariadb
    state: started
    restart_policy: always
    volume:
      - mariadb_data:/var/lib/mysql:Z
    network: nextcloud_network
    env:
      MYSQL_ROOT_PASSWORD: iI5tG6pThrrH8O7i
      MYSQL_PASSWORD: iI5tG6pThrrH8O7i
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud

- name: Run Nextcloud container
  containers.podman.podman_container:
    name: nextcloud
    image: docker.io/library/nextcloud
    state: started
    restart_policy: always
    publish:
      - 42348:80
    volume:
      - nextcloud_config:/var/www/html:Z
      - "{{ container_data.nextcloud }}:/var/www/html/data:UZ"
    network: nextcloud_network
    env:
      MYSQL_PASSWORD: iI5tG6pThrrH8O7i
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud
      MYSQL_HOST: mariadb