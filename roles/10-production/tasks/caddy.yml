---
- name: Template Caddy configuration
  ansible.builtin.template:
    src: Caddyfile.j2
    dest: "{{ volumes.caddy }}/Caddyfile"

- name: Create Caddy volumes
  containers.podman.podman_volume:
    state: present
    name: "{{ item }}"
  loop: 
    - caddy_data
    - caddy_config

- name: Run Caddy container
  containers.podman.podman_container:
    name: caddy
    image: docker.io/library/caddy:alpine
    state: started
    restart_policy: always
    recreate: true
    ports:
      - 80:80
      - 443:443
    volumes:
      - "{{ volumes.caddy }}/Caddyfile:/etc/caddy/Caddyfile:Z"
      - caddy_data:/data:Z
      - caddy_config:/config:Z